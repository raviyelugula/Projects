{
    "collab_server" : "",
    "contents" : "if (Sys.getenv(\"JAVA_HOME\")!=\"\") Sys.setenv(JAVA_HOME=\"\")\nrequire(twitteR)\nrequire(tm)\nrequire(stringr)\nrequire(qdap)\nrequire(ggplot2)\nrequire(wordcloud)\nrequire(topicmodels)\nrequire(tidytext)\nrequire(dplyr)\nrequire(plotrix)\nrequire(ggthemes)\nsetup_twitter_oauth(\n  consumer_key = \"MTfL0uv6oBbtVBa3dPuR4PS51\",\n  consumer_secret = \"T480vrOtvSK1XxGcPp20SdRoW99by3EGVvAapzyq8io0uH6lUh\",\n  access_token = \"191958252-uOisKMkvWHWmiTRQnf9d6XMww5wtZVtox1ShcjMm\",\n  access_secret = \"9kTTYtORX4KnXk9SG4R9bQ1PpmQyBYEwmfvDksTh6Wht0\")\ngetCurRateLimitInfo(resources = 'search')\n\n# CocaCola_TweetsList= searchTwitter(searchString ='Coke',n=10000 , lang = 'en') \n# Pepsi_TweetsList= searchTwitter(searchString ='Pepsi',n=10000 , lang = 'en') \n# CocaCola_DF = twListToDF(CocaCola_TweetsList)\n# Pepsi_DF = twListToDF(Pepsi_TweetsList)\n\n# write.csv(CocaCola_DF,'CocaCola_DF.csv',row.names = F) # fetched at 18th sep 08:10PM IST\n# write.csv(Pepsi_DF,'Pepsi_DF.csv',row.names = F)\n\nCocaCola_DF = read.csv(file ='CocaCola_DF.csv',header = T)\nPepsi_DF = read.csv(file ='Pepsi_DF.csv',header = T)\n\nCocaCola_DF$createdDate = as.Date(CocaCola_DF$created,format = \"%d-%m-%Y\")\nPepsi_DF$createdDate = as.Date(Pepsi_DF$created,format = \"%d-%m-%Y\")\n\nCocaCola_Tweets = as.character(CocaCola_DF$text)\nCocaCola_Corpus = Corpus(VectorSource(CocaCola_Tweets))\n\nPepsi_Tweets = as.character(Pepsi_DF$text)\nPepsi_Corpus = Corpus(VectorSource(Pepsi_Tweets))\n\nremoveUsernameInRT <- function(x) str_replace_all(x,\"(?<=@)[^\\\\s:]+\",'')\nCocaCola_Corpus = tm_map(CocaCola_Corpus, content_transformer(removeUsernameInRT))\nPepsi_Corpus = tm_map(Pepsi_Corpus, content_transformer(removeUsernameInRT))\n\nremoveURL <- function(x) gsub(\"http[^[:space:]]*\", \"\", x)\nCocaCola_Corpus = tm_map(CocaCola_Corpus, content_transformer(removeURL))\nPepsi_Corpus = tm_map(Pepsi_Corpus, content_transformer(removeURL))\n\nremoveCompleteNumbers <- function(x) str_replace_all(x,'(?<=[:blank:])[0-9]+(?=[:blank:])', '')\nCocaCola_Corpus = tm_map(CocaCola_Corpus, content_transformer(removeCompleteNumbers))\nPepsi_Corpus = tm_map(Pepsi_Corpus, content_transformer(removeCompleteNumbers))\n\nCocaCola_Corpus = tm_map(CocaCola_Corpus,removePunctuation)\nPepsi_Corpus = tm_map(Pepsi_Corpus,removePunctuation)\nremoveSingle <- function(x) gsub(\" . \", \" \", x)   \nCocaCola_Corpus = tm_map(CocaCola_Corpus, content_transformer(removeSingle))\nCocaCola_Corpus = tm_map(CocaCola_Corpus,stripWhitespace)\nCocaCola_Corpus = tm_map(CocaCola_Corpus,content_transformer(tolower))\nCocaCola_Corpus = tm_map(CocaCola_Corpus, content_transformer(replace_abbreviation))\nPepsi_Corpus = tm_map(Pepsi_Corpus, content_transformer(removeSingle))\nPepsi_Corpus = tm_map(Pepsi_Corpus,stripWhitespace)\nPepsi_Corpus = tm_map(Pepsi_Corpus,content_transformer(tolower))\nPepsi_Corpus = tm_map(Pepsi_Corpus, content_transformer(replace_abbreviation))\n\nCocaCola_Corpus_Filtered = CocaCola_Corpus\nCocaCola_Corpus = tm_map(CocaCola_Corpus, stemDocument,language = 'english')\nPepsi_Corpus_Filtered = Pepsi_Corpus\nPepsi_Corpus = tm_map(Pepsi_Corpus, stemDocument,language = 'english')\n\nstemCompletionuserDefined <- function(x,dictionary) {\n  x = unlist(strsplit(as.character(x),\" \"))\n  x = x[x !=\"\"]\n  x = stemCompletion(x, dictionary = dictionary)\n  x = paste(x, sep=\"\", collapse=\" \")\n  PlainTextDocument(stripWhitespace(x))\n}\nCocaCola_Corpus = lapply(CocaCola_Corpus, stemCompletionuserDefined, dictionary=CocaCola_Corpus_Filtered)\nPepsi_Corpus = lapply(Pepsi_Corpus, stemCompletionuserDefined, dictionary=Pepsi_Corpus_Filtered)\n\ntemp = character()\nfor(i in 1: nrow(CocaCola_DF)){\n  temp[i] = CocaCola_Corpus[[i]]$content\n}\ntemp_df = data.frame(text = temp, stringsAsFactors = F)\nCocaCola_Corpus = Corpus(VectorSource(temp_df$text))\nCocaCola_Corpus = tm_map(CocaCola_Corpus, \n                       removeWords,c(stopwords('en'),'rt','cocacola','coke','drink'))\ntemp1 = character()\nfor(i in 1: nrow(Pepsi_DF)){\n  temp1[i] = Pepsi_Corpus[[i]]$content\n}\ntemp_df1 = data.frame(text = temp1, stringsAsFactors = F)\nPepsi_Corpus = Corpus(VectorSource(temp_df1$text))\nPepsi_Corpus = tm_map(Pepsi_Corpus, \n                         removeWords,c(stopwords('en'),'rt','pepsi','drink'))\nrm(list = c('temp1','temp_df1','temp_df','temp'))\n\nCocaCola_Corpus_TDM = TermDocumentMatrix(CocaCola_Corpus)\nCocaCola_Corpus_TDM_M = as.matrix(CocaCola_Corpus_TDM)\nCocaCola_TermFrequency = rowSums(CocaCola_Corpus_TDM_M)\nCocaCola_TermFrequency = sort(CocaCola_TermFrequency,decreasing =T)\nPepsi_Corpus_TDM = TermDocumentMatrix(Pepsi_Corpus)\nPepsi_Corpus_TDM_M = as.matrix(Pepsi_Corpus_TDM)\nPepsi_TermFrequency = rowSums(Pepsi_Corpus_TDM_M)\nPepsi_TermFrequency = sort(Pepsi_TermFrequency,decreasing =T)\n\nFrequency_DF = data.frame(term = names(CocaCola_TermFrequency), \n                           freq= CocaCola_TermFrequency,\n                           brand = 'CocaCola')\nFrequency_DF = rbind(Frequency_DF,data.frame(term = names(Pepsi_TermFrequency), \n                                             freq= Pepsi_TermFrequency,\n                                             brand = 'Pepsi') )\nFrequency_DF %>%\n  top_n(25,freq) %>%\nggplot(aes(reorder(term, freq),freq,fill= brand)) +\n  scale_fill_brewer(palette=\"Set1\")+\n  geom_bar(stat = \"identity\") + \n  coord_flip() +\n  labs(list(title=\"Term Frequency Chart\", x=\"Top 25 Terms\", y=\"Term Counts\")) \n\nindex = which(dimnames(CocaCola_Corpus_TDM)$Terms %in% c(\"like\", \"diet\"))\nas.matrix(CocaCola_Corpus_TDM[index,1:50])\nindex = which(dimnames(Pepsi_Corpus_TDM)$Terms %in% c(\"like\",'coke'))\nas.matrix(Pepsi_Corpus_TDM[index,1:50])\n\npal = brewer.pal(6, \"Reds\")\npal = pal[2:6]\nwordcloud(words = names(CocaCola_TermFrequency), \n          freq = CocaCola_TermFrequency, \n          min.freq = 10, \n          random.order = F, \n          colors = pal, \n          max.words = 500)\npal = brewer.pal(7, \"Blues\")\npal = pal[4:7]\nwordcloud(words = names(Pepsi_TermFrequency), \n          freq = Pepsi_TermFrequency, \n          min.freq = 10, \n          random.order = F, \n          colors = pal, \n          max.words = 500)\n\nPepsi_Associations = findAssocs(Pepsi_Corpus_TDM,terms ='like',corlimit=0.15)\nPepsi_Associations\nPepsi_Associations_df = list_vect2df(Pepsi_Associations)[, 2:3]\n\nggplot(Pepsi_Associations_df, aes(y = Pepsi_Associations_df[, 1])) + \n  geom_point(aes(x = Pepsi_Associations_df[, 2],colour = Pepsi_Associations_df[, 2],\n                 size = Pepsi_Associations_df[, 2] ), \n             data = Pepsi_Associations_df) + \n  theme_gdocs()+\n  scale_color_continuous(high = '#18069A',low = \"#8985A3\")+\n  guides(colour=FALSE,size =F)+\n  xlab('Correlation')+ylab('Words')+ggtitle('Pepsi tweets Association with \"like\" ')\ncolnames(Pepsi_Associations_df) = c('Words','Corr')\nqheat(Pepsi_Associations_df, values=TRUE, high=\"blue\",\n      digits=2, plot = FALSE) +\n  coord_flip()+guides(fill=F,ylab=F)+\n  xlab('Words')+ggtitle('Pepsi tweets HeatMap with \"like\"')\n\n\nCocaCola_Associations = findAssocs(CocaCola_Corpus_TDM,terms ='like',corlimit=0.1)\nCocaCola_Associations\nCocaCola_Associations_df = list_vect2df(CocaCola_Associations)[, 2:3]\n\nggplot(CocaCola_Associations_df, aes(y = CocaCola_Associations_df[, 1])) + \n  geom_point(aes(x = CocaCola_Associations_df[, 2],colour = CocaCola_Associations_df[, 2],\n                 size = CocaCola_Associations_df[, 2] ), \n             data = CocaCola_Associations_df) + \n  theme_gdocs()+\n  scale_color_continuous(high = '#C40315',low = \"#DE6C76\")+\n  guides(colour=FALSE,size =F)+\n  xlab('Correlation')+ylab('Words')+ggtitle('CocaCola tweets Association with \"like\" ')\ncolnames(CocaCola_Associations_df) = c('Words','Corr')\nqheat(CocaCola_Associations_df, values=TRUE, high=\"red\",\n      digits=2, plot = FALSE) +\n  coord_flip()+guides(fill=F,ylab=F)+\n  xlab('Words')+ggtitle('CocaCola tweets HeatMap with \"like\"')\n\n\nCocaCola_Corpus_DTM <- as.DocumentTermMatrix(CocaCola_Corpus_TDM)\nCrowTotals <- apply(CocaCola_Corpus_DTM , 1, sum)\nCNullDocs <- CocaCola_Corpus_DTM[CrowTotals==0, ]\nCocaCola_Corpus_DTM   <- CocaCola_Corpus_DTM[CrowTotals> 0, ]\nif (length(CNullDocs$dimnames$Docs) > 0) {\n  CocaCola_DF <- CocaCola_DF[-as.numeric(CNullDocs$dimnames$Docs),]\n}\nClda <- LDA(CocaCola_Corpus_DTM, k = 5) \nCterm <- terms(Clda, 5) \nCterm\nCtopics<- topics(Clda)\nCtopics_df<- data.frame(date=(CocaCola_DF$created), topic = Ctopics)\nX = cut(as.numeric(strftime(Ctopics_df$date, format=\"%H\")),c(0,6,12,18,24))\nlevels(X) = c('night','morning','noon','evening')\nqplot(date,..count.., data=Ctopics_df,\n      geom =\"density\",\n      fill= Cterm[topic],position=\"stack\",\n      xlab = 'Tweets Time', ylab='Count',main = 'Coca-Cola Topic Density')\n\nPepsi_Corpus_DTM <- as.DocumentTermMatrix(Pepsi_Corpus_TDM)\nProwTotals <- apply(Pepsi_Corpus_DTM , 1, sum)\nPNullDocs <- Pepsi_Corpus_DTM[ProwTotals==0, ]\nPepsi_Corpus_DTM   <- Pepsi_Corpus_DTM[ProwTotals> 0, ]\nif (length(PNullDocs$dimnames$Docs) > 0) {\n  Pepsi_DF <- Pepsi_DF[-as.numeric(PNullDocs$dimnames$Docs),]\n}\nPlda <- LDA(Pepsi_Corpus_DTM, k = 5) \nPterm <- terms(Plda, 5) \nPterm\nPtopics<- topics(Plda)\nPtopics_df<- data.frame(date=(Pepsi_DF$created), topic = Ptopics)\nX = cut(as.numeric(strftime(Ptopics_df$date, format=\"%H\")),c(0,6,12,18,24))\nlevels(X) = c('night','morning','noon','evening')\nqplot(X,..count.., data=Ptopics_df,\n      geom =\"density\",\n      fill= Pterm[topic],position=\"stack\",\n      xlab = 'Tweets Time', ylab='Count',main = 'Pepsi Topic Density')\n\n\ncolnames(Frequency_DF) = c('word','freq','brand')\nsentiment_df = Frequency_DF %>% \n  inner_join(get_sentiments('bing'), by='word')\nsentiment_df = sentiment_df %>%\n  inner_join(get_sentiments('afinn'),by='word') \n\nsentiment_df %>%\n  top_n(25,freq) %>%\n  mutate(x1 = reorder(word,freq),\n         y1 = ifelse(sentiment=='positive',freq,-freq)) %>%\n  ggplot(aes(x=x1, y= y1, fill = brand)) +\n  scale_fill_brewer(palette=\"Set1\")+\n  geom_col(stat='identity') +\n  coord_flip()+\n  facet_wrap(~sentiment, scales = \"free_x\")+\n  ggtitle('Lexicon based word frequency')+\n  xlab('Words')+ylab('Frequency')\n\nEmotion_sentiment_df = Frequency_DF %>% \n  inner_join(get_sentiments('nrc'), by='word')\nEmotion_sentiment_df %>%\n  group_by(sentiment) %>%\n  top_n(8,freq) %>%\n  ungroup() %>%\n  mutate(word = reorder(word, freq)) %>%\n  ggplot(aes(x = word, y = freq , fill  = brand)) +\n  scale_fill_brewer(palette=\"Set1\")+\n  geom_col(show.legend = T) +\n  facet_wrap(~ sentiment, scales = \"free\") +\n  coord_flip()+\n  ggtitle('Emotion based word frequency')+\n  xlab('Words')+ylab('Frequency')\n\n\n\n\n",
    "created" : 1507541346918.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "556935461",
    "id" : "D742DA2F",
    "lastKnownWriteTime" : 1505784149,
    "last_content_update" : 1505784149,
    "path" : "~/GitHub/Projects/Twitter HashTag Analysis/CokeVsPepsi.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}